<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Bias Detection Simulator</title>
    <style>
        /* Embedded Ivey CSS */
        @import url('https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ivey-green: #034638;
            --ivey-purple: #582C83;
            --ivey-orange: #f97316;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #2d3748;
            --bg-white: #ffffff;
            --bg-light: #f8fafc;
            --bg-subtle: #f1f5f9;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e0;
            --hover-bg: #f8fafc;
            --error-red: #e53e3e;
            --warning-yellow: #d69e2e;
            --success-green: #38a169;
        }

        body {
            font-family: 'Figtree', Arial, sans-serif;
            background: var(--bg-white);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            margin: 0;
            padding: 20px;
        }

        .widget-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-white);
        }

        .widget-header {
            background: var(--ivey-green);
            color: white;
            padding: 20px 24px;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin: -20px -20px 30px -20px;
        }

        .widget-title {
            font-size: 1.8em;
            font-weight: 700;
            margin: 0;
            color: white !important;
        }

        .widget-subtitle {
            font-size: 1.1em;
            font-weight: 500;
            margin: 8px 0 0 0;
            opacity: 0.9;
        }

        h2 { font-size: 1.5rem; color: var(--ivey-green); margin-bottom: 1rem; }
        h3 { font-size: 1.25rem; color: var(--ivey-purple); margin-bottom: 0.75rem; }

        p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .simulator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .control-panel {
            background: var(--bg-light);
            border: 2px solid var(--ivey-green);
            border-radius: 8px;
            padding: 20px;
        }

        .results-panel {
            background: var(--bg-white);
            border: 2px solid var(--ivey-purple);
            border-radius: 8px;
            padding: 20px;
        }

        .panel-title {
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 1.2em;
        }

        .control-panel .panel-title {
            color: var(--ivey-green);
        }

        .results-panel .panel-title {
            color: var(--ivey-purple);
        }

        .bias-stage {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .bias-stage.active {
            border-color: var(--ivey-orange);
            background: rgba(249, 115, 22, 0.05);
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stage-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95em;
        }

        .stage-number {
            background: var(--ivey-green);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8em;
        }

        .bias-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-light);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .bias-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--ivey-green);
            cursor: pointer;
        }

        .bias-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--ivey-green);
            cursor: pointer;
            border: none;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .result-metric {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
            text-align: center;
        }

        .metric-label {
            font-size: 0.85em;
            color: var(--text-muted);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .metric-value.high {
            color: var(--error-red);
        }

        .metric-value.medium {
            color: var(--warning-yellow);
        }

        .metric-value.low {
            color: var(--success-green);
        }

        .metric-description {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .scenario-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .scenario-btn {
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            background: var(--bg-white);
            border-radius: 6px;
            font-family: 'Figtree', Arial, sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .scenario-btn:hover {
            border-color: var(--ivey-green);
            background: var(--hover-bg);
        }

        .scenario-btn.active {
            background: var(--ivey-green);
            color: white;
            border-color: var(--ivey-green);
        }

        .insights-panel {
            background: var(--bg-subtle);
            border-radius: 8px;
            padding: 20px;
            margin: 24px 0;
        }

        .insight-item {
            background: var(--bg-white);
            border-left: 4px solid var(--ivey-orange);
            border-radius: 4px;
            padding: 12px 16px;
            margin-bottom: 12px;
        }

        .insight-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: 0.95em;
        }

        .insight-text {
            color: var(--text-secondary);
            font-size: 0.9em;
            line-height: 1.4;
        }

        .callout {
            padding: 16px 20px;
            border-radius: 6px;
            margin: 16px 0;
            border-left: 4px solid var(--ivey-green);
            background: var(--bg-light);
        }

        .callout-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1em;
        }

        .reset-btn {
            background: var(--ivey-orange);
            color: white;
            border: 2px solid var(--ivey-orange);
            border-radius: 6px;
            padding: 10px 16px;
            font-family: 'Figtree', Arial, sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 16px;
        }

        .reset-btn:hover {
            background: #ea580c;
            border-color: #ea580c;
        }

        @media (max-width: 768px) {
            .widget-container {
                padding: 15px;
            }

            .simulator-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .scenario-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .scenario-btn {
                padding: 10px 12px;
                font-size: 13px;
            }
        }

        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="widget-container">
        <!-- Header -->
        <div class="widget-header">
            <h1 class="widget-title">ML Bias Detection Simulator</h1>
            <div class="widget-subtitle">Explore How Bias Emerges Across the Machine Learning Development Pipeline</div>
        </div>

        <!-- Instructions -->
        <div class="callout">
            <div class="callout-title">üéØ How to Use This Simulator</div>
            <p>Adjust the bias sliders for each development stage to see how bias cascades through the ML pipeline. Try the preset scenarios to explore real-world bias patterns, including the COMPAS algorithm configuration.</p>
        </div>

        <!-- Preset Scenarios -->
        <div class="scenario-buttons">
            <button class="scenario-btn" onclick="loadScenario('baseline')">üîÑ Baseline</button>
            <button class="scenario-btn" onclick="loadScenario('compas')">‚öñÔ∏è COMPAS</button>
            <button class="scenario-btn" onclick="loadScenario('hiring')">üè¢ Hiring AI</button>
            <button class="scenario-btn" onclick="loadScenario('medical')">üè• Medical AI</button>
            <button class="scenario-btn" onclick="loadScenario('lending')">üí∞ Credit Scoring</button>
        </div>

        <!-- Main Simulator -->
        <div class="simulator-grid">
            <!-- Control Panel -->
            <div class="control-panel">
                <h3 class="panel-title">‚öôÔ∏è ML Development Stages</h3>
                <p class="mb-3">Adjust bias levels at each stage of the ML pipeline:</p>

                <div class="bias-stage" id="stage-1">
                    <div class="stage-header">
                        <span class="stage-name">1. Data Collection</span>
                        <span class="stage-number">1</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-1" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-2">
                    <div class="stage-header">
                        <span class="stage-name">2. Data Preparation</span>
                        <span class="stage-number">2</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-2" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-3">
                    <div class="stage-header">
                        <span class="stage-name">3. Feature Engineering</span>
                        <span class="stage-number">3</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-3" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-4">
                    <div class="stage-header">
                        <span class="stage-name">4. Model Training</span>
                        <span class="stage-number">4</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-4" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-5">
                    <div class="stage-header">
                        <span class="stage-name">5. Model Validation</span>
                        <span class="stage-number">5</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-5" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-6">
                    <div class="stage-header">
                        <span class="stage-name">6. Deployment</span>
                        <span class="stage-number">6</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-6" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <div class="bias-stage" id="stage-7">
                    <div class="stage-header">
                        <span class="stage-name">7. Monitoring</span>
                        <span class="stage-number">7</span>
                    </div>
                    <input type="range" class="bias-slider" id="bias-7" min="0" max="10" value="0" oninput="updateSimulation()">
                    <div class="slider-labels">
                        <span>No Bias</span>
                        <span>High Bias</span>
                    </div>
                </div>

                <button class="reset-btn" onclick="resetSimulation()">Reset All Stages</button>
            </div>

            <!-- Results Panel -->
            <div class="results-panel">
                <h3 class="panel-title">üìä Bias Impact Analysis</h3>
                <p class="mb-3">Real-time assessment of bias effects:</p>

                <div class="result-metric">
                    <div class="metric-label">Overall System Bias</div>
                    <div class="metric-value low" id="overall-bias">0%</div>
                    <div class="metric-description">Cumulative bias across all stages</div>
                </div>

                <div class="result-metric">
                    <div class="metric-label">Model Accuracy</div>
                    <div class="metric-value low" id="model-accuracy">95%</div>
                    <div class="metric-description">Predictive performance (higher is better)</div>
                </div>

                <div class="result-metric">
                    <div class="metric-label">Fairness Score</div>
                    <div class="metric-value low" id="fairness-score">100%</div>
                    <div class="metric-description">Equal treatment across groups</div>
                </div>

                <div class="result-metric">
                    <div class="metric-label">False Positive Rate Gap</div>
                    <div class="metric-value low" id="fpr-gap">0%</div>
                    <div class="metric-description">Difference between demographic groups</div>
                </div>

                <h4 style="color: var(--ivey-purple); margin: 20px 0 12px 0;">Risk Assessment</h4>
                <div id="risk-level" style="padding: 12px; border-radius: 6px; background: var(--success-green); color: white; text-align: center; font-weight: 600;">
                    LOW RISK - System operating within acceptable parameters
                </div>
            </div>
        </div>

        <!-- Dynamic Insights -->
        <div class="insights-panel">
            <h3 class="text-center" style="color: var(--ivey-green); margin-bottom: 16px;">üîç Real-Time Insights</h3>
            <div id="insights-container">
                <div class="insight-item">
                    <div class="insight-title">System Status</div>
                    <div class="insight-text">All bias levels set to baseline. Adjust the sliders to explore how bias emerges and cascades through the ML pipeline.</div>
                </div>
            </div>
        </div>

        <!-- Educational Content -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 24px;">
            <div style="background: var(--bg-light); border: 2px solid var(--ivey-green); border-radius: 8px; padding: 20px;">
                <h4 style="color: var(--ivey-green); margin-bottom: 12px;">üéØ Key Learning Points</h4>
                <ul style="margin: 0; padding-left: 20px; color: var(--text-secondary);">
                    <li>Bias can enter at any stage of ML development</li>
                    <li>Early-stage bias amplifies throughout the pipeline</li>
                    <li>Multiple bias sources compound exponentially</li>
                    <li>Different industries have varying sensitivity patterns</li>
                </ul>
            </div>

            <div style="background: var(--bg-light); border: 2px solid var(--ivey-purple); border-radius: 8px; padding: 20px;">
                <h4 style="color: var(--ivey-purple); margin-bottom: 12px;">‚öñÔ∏è COMPAS Connection</h4>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9em;">
                    The COMPAS scenario replicates the bias patterns identified in the ProPublica investigation. Notice how historical bias in data collection (Stage 1) creates disparate impacts even without explicit discrimination.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Simulation state
        let currentScenario = 'baseline';

        // Scenario configurations
        const scenarios = {
            baseline: [0, 0, 0, 0, 0, 0, 0],
            compas: [7, 5, 6, 4, 5, 8, 6],
            hiring: [4, 6, 8, 5, 3, 7, 4],
            medical: [3, 4, 5, 6, 9, 4, 5],
            lending: [6, 8, 7, 5, 4, 6, 3]
        };

        function loadScenario(scenarioName) {
            currentScenario = scenarioName;
            const values = scenarios[scenarioName];

            // Update all sliders
            for (let i = 1; i <= 7; i++) {
                document.getElementById(`bias-${i}`).value = values[i-1];
                updateStageVisuals(i, values[i-1]);
            }

            // Update button states
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            updateSimulation();
        }

        function updateStageVisuals(stageNumber, biasLevel) {
            const stage = document.getElementById(`stage-${stageNumber}`);
            if (biasLevel > 5) {
                stage.classList.add('active');
            } else {
                stage.classList.remove('active');
            }
        }

        function updateSimulation() {
            // Get all bias values
            const biasValues = [];
            for (let i = 1; i <= 7; i++) {
                const value = parseInt(document.getElementById(`bias-${i}`).value);
                biasValues.push(value);
                updateStageVisuals(i, value);
            }

            // Calculate metrics
            const overallBias = calculateOverallBias(biasValues);
            const accuracy = calculateAccuracy(biasValues);
            const fairness = calculateFairness(biasValues);
            const fprGap = calculateFPRGap(biasValues);

            // Update displays
            updateMetricDisplay('overall-bias', overallBias, '%');
            updateMetricDisplay('model-accuracy', accuracy, '%');
            updateMetricDisplay('fairness-score', fairness, '%');
            updateMetricDisplay('fpr-gap', fprGap, '%');

            // Update risk level
            updateRiskLevel(overallBias);

            // Update insights
            updateInsights(biasValues, overallBias);
        }

        function calculateOverallBias(values) {
            // Weighted calculation with cascade effects
            let totalBias = 0;
            let cascadeMultiplier = 1;

            for (let i = 0; i < values.length; i++) {
                totalBias += values[i] * cascadeMultiplier;
                if (values[i] > 5) cascadeMultiplier += 0.2;
            }

            return Math.min(Math.round(totalBias / 2), 100);
        }

        function calculateAccuracy(values) {
            const overallBias = calculateOverallBias(values);
            return Math.max(95 - Math.round(overallBias * 0.8), 30);
        }

        function calculateFairness(values) {
            const overallBias = calculateOverallBias(values);
            return Math.max(100 - overallBias, 10);
        }

        function calculateFPRGap(values) {
            const historicalBias = values[0]; // Data collection stage
            const deploymentBias = values[5]; // Deployment stage
            return Math.min(historicalBias * 2 + deploymentBias, 50);
        }

        function updateMetricDisplay(elementId, value, suffix) {
            const element = document.getElementById(elementId);
            element.textContent = value + suffix;

            // Update color based on value ranges
            element.className = 'metric-value';
            if (elementId === 'overall-bias' || elementId === 'fpr-gap') {
                if (value > 30) element.classList.add('high');
                else if (value > 15) element.classList.add('medium');
                else element.classList.add('low');
            } else {
                if (value < 60) element.classList.add('high');
                else if (value < 80) element.classList.add('medium');
                else element.classList.add('low');
            }
        }

        function updateRiskLevel(overallBias) {
            const riskElement = document.getElementById('risk-level');

            if (overallBias > 40) {
                riskElement.style.background = 'var(--error-red)';
                riskElement.textContent = 'HIGH RISK - Significant bias detected across multiple stages';
            } else if (overallBias > 20) {
                riskElement.style.background = 'var(--warning-yellow)';
                riskElement.style.color = 'var(--text-primary)';
                riskElement.textContent = 'MEDIUM RISK - Moderate bias levels require attention';
            } else {
                riskElement.style.background = 'var(--success-green)';
                riskElement.style.color = 'white';
                riskElement.textContent = 'LOW RISK - System operating within acceptable parameters';
            }
        }

        function updateInsights(biasValues, overallBias) {
            const container = document.getElementById('insights-container');
            const insights = generateInsights(biasValues, overallBias);

            container.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-text">${insight.text}</div>
                </div>
            `).join('');
        }

        function generateInsights(values, overallBias) {
            const insights = [];

            // Check for early stage bias
            if (values[0] > 6 || values[1] > 6) {
                insights.push({
                    title: "Early Stage Bias Detected",
                    text: "High bias in data collection or preparation stages will cascade through the entire pipeline, amplifying downstream effects."
                });
            }

            // Check for validation issues
            if (values[4] > 7) {
                insights.push({
                    title: "Validation Bias Warning",
                    text: "Poor validation practices may hide bias problems until deployment, making them harder and more expensive to fix."
                });
            }

            // Check for deployment bias
            if (values[5] > 6) {
                insights.push({
                    title: "Deployment Mismatch Risk",
                    text: "High deployment bias suggests the model is being used in ways it wasn't designed for, leading to unfair outcomes."
                });
            }

            // Overall assessment
            if (overallBias > 30) {
                insights.push({
                    title: "System-Wide Bias Concerns",
                    text: "Multiple bias sources are compounding. Consider comprehensive bias audit and remediation strategies."
                });
            } else if (overallBias < 10) {
                insights.push({
                    title: "Good Bias Management",
                    text: "Current bias levels are within acceptable ranges. Continue monitoring and maintain current safeguards."
                });
            }

            // Scenario-specific insights
            if (currentScenario === 'compas') {
                insights.push({
                    title: "COMPAS Pattern Analysis",
                    text: "This configuration mirrors the bias sources identified in the COMPAS algorithm: historical data bias, proxy variables, and deployment scope expansion."
                });
            }

            return insights.length > 0 ? insights : [{
                title: "System Status",
                text: "Adjust the bias sliders to explore how different stages contribute to overall system bias and fairness concerns."
            }];
        }

        function resetSimulation() {
            loadScenario('baseline');
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
        }

        // Initialize simulation
        updateSimulation();
    </script>
</body>
</html>